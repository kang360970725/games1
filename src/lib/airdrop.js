"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function airdrop(web3){var self=this;self.web3=web3;var network=web3.version.network,addr=deployed.airdrop[network];self.c=new Contract(web3.eth.contract(abi.airdrop).at(addr))}var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),erc20=require("./erc20"),deployed=require("./deployed"),Contract=require("./contract"),abi=require("./abi");airdrop.prototype.dropToken=function(addrs,amount,tokenAddr,opt){var self=this;return erc20.erc20At(tokenAddr,self.web3).then(function(token){var value=new self.web3.BigNumber(amount);return token.decimals().then(function(_decimals){return value=value.mul(Math.pow(10,_decimals)),self.c.getFee()}).then(function(_fee){return opt||(opt={}),opt.value=_fee,self.c.drop(tokenAddr,addrs,value,opt)})})},airdrop.prototype.dropEth=function(addrs,amount){var self=this,value=new self.web3.BigNumber(amount);return value=value.mul(Math.pow(10,18)),self.c.getFee().then(function(_fee){var sendEth=value.mul(addrs.length);return sendEth=sendEth.add(_fee),self.c.drop("0x0",addrs,value,{value:sendEth})})},airdrop.prototype.dropTokenS=function(addrs,amounts,tokenAddr){var self=this;return erc20.erc20At(tokenAddr).then(function(tokenC){return tokenC.decimals()}).then(function(_decimals){var m=Math.pow(10,_decimals.toNumber());return amounts.map(function(_a){var _amount=new self.web3.BigNumber(_a);return _amount=_amount.mul(m)})}).then(function(_v){return self.c.getFee().then(function(_fee){return self.c.drop2(tokenAddr,addrs,_v,{value:_fee})})})},airdrop.prototype.dropEthS=function(addrs,amounts){var self=this,m=Math.pow(10,18),total=null;return self.c.getFee().then(function(_fee){return total=_fee,amounts.map(function(_a){return _a=new self.web3.BigNumber(_a),_a=_a.mul(m),total=total.add(_a),_a})}).then(function(_v){return self.c.drop2("0x0",addrs,_v,{value:total})})},airdrop.prototype.estimateSendToken=function(tokenAddr,amount,onCount){var _this=this,self=this;return erc20.erc20At(tokenAddr).then(function(token){var value=new self.web3.BigNumber(amount);return token.decimals().then(function(_decimals){return value=value.mul(Math.pow(10,_decimals)),self.c.getFee()}).then(function(){var _ref=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee(_fee){var address,addresses,start,i,n,_i;return _regenerator2["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:for(address="0x92694d5c7e2655e3f358130ebd0e7Db3FbD3e455",addresses=[],start=80,i=0;i<start;i++)addresses.push(address);n=start;case 5:return _context.prev=5,_context.next=8,self.c.gasOf_drop(token,addresses,value,{value:_fee});case 8:onCount(n,!0),_context.next=15;break;case 11:return _context.prev=11,_context.t0=_context["catch"](5),onCount(n,!1),_context.abrupt("break",19);case 15:for(_i=0;_i<10;_i++)addresses.push(address);case 16:n+=10,_context.next=5;break;case 19:return _context.abrupt("return",n-10);case 20:case"end":return _context.stop()}},_callee,_this,[[5,11]])}));return function(_x){return _ref.apply(this,arguments)}}())})},airdrop.prototype.price=function(){var self=this;return self.c.getFee().then(function(_fee){return self.web3.fromWei(_fee)})},airdrop.prototype.gasOfDropToken=function(addrs,amount,tokenAddr,opt){var self=this;return erc20.erc20At(tokenAddr,self.web3).then(function(token){var value=new self.web3.BigNumber(amount);return token.decimals().then(function(_decimals){return value=value.mul(Math.pow(10,_decimals)),self.c.getFee()}).then(function(_fee){return opt.value=_fee,self.c.gasOf_drop(tokenAddr,addrs,value,opt)})})},module.exports=airdrop;