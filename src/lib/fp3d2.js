"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function Fp3d(address,web3,callback){var self=this;self.web3=web3,self.c=new Contract(web3.eth.contract(abi).at(address)),self.params={};var props=["a","b","ta","tb","tc","td","te","wa","wb","wc","wd","we","decimals","maxTimeRemain","timeGap"];async.each(props,function(prop,callback){self.c[prop]().then(function(_propValue){self.params[prop]=_propValue,callback()})},callback)}function getFp3d(web3){return deployed.fp3d2.hasOwnProperty(web3.version.network)?new _promise2["default"](function(r,j){var fp3d=new Fp3d(deployed.fp3d2[web3.version.network],web3,function(err){err?j(err):r(fp3d)})}):_promise2["default"].reject(errors.UNSUPPORTED_NETWORK)}var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),deployed=require("./deployed"),errors=require("./errors"),abi=require("./abi").fp3d2,Contract=require("./contract"),async=require("async");Fp3d.prototype.remainSeconds=function(){return this.c.remainTime()},Fp3d.prototype.price=function(n){var self=this;return self.c.Price(n)},Fp3d.prototype.round=function(){return this.c.currentRound()},Fp3d.prototype.buy=function(value,ref){return value=value.mul(Math.pow(10,18)),ref||(ref=0),this.c.BuyKeys(ref,{value:value})},Fp3d.prototype.reloadKeys=function(value,ref){return this.c.ReloadKeys(value,ref)},Fp3d.prototype.currentRound=function(){var _this=this;return this.c.currentRound().then(function(_round){return _this.c.rounds(_round)})},Fp3d.prototype.register=function(ref){return this.c.register(ref)},Fp3d.prototype.stat=function(address){var stat={},self=this;return self.c.currentRound().then(function(_currentRound){return stat.currentRound=_currentRound.toNumber(),self.c.owner()}).then(function(_owner){return stat.owner=_owner,self.c.decimals()}).then(function(_decimals){return stat.decimals=_decimals.toNumber(),self.c.rounds(stat.currentRound)}).then(function(_round){return stat.round_eth=_round[0].dividedBy(Math.pow(10,18)).toNumber(),stat.round_keys=_round[1].dividedBy(stat.decimals).toNumber(),stat.mask=_round[2],stat.winner=_round[3],stat.pool=_round[4].dividedBy(Math.pow(10,18)).toNumber(),self.c.playerIds(address)}).then(function(_id){return _id.eq(0)&&address!==stat.owner?void(stat.id=-1):(stat.id=_id.toNumber(),self.c.players(_id).then(function(_player){return stat.affiliate=_player[2].dividedBy(Math.pow(10,18)).toNumber(),stat.win=_player[3].dividedBy(Math.pow(10,18)).toNumber(),self.c.playerRoundData(stat.id,stat.currentRound)}).then(function(_playerRound){return stat.player_eth=_playerRound[0].dividedBy(Math.pow(10,18)).toNumber(),stat.player_keys=_playerRound[1].dividedBy(stat.decimals).toNumber(),self.c.profit({from:address})}).then(function(_profit){stat.profit=_profit.dividedBy(Math.pow(10,18)).toNumber(),stat.wallet=stat.profit-stat.affiliate-stat.win}))}).then(function(){return stat})},Fp3d.prototype.withdrawal=function(ref){return this.c.withdrawal(ref)},Fp3d.prototype.finalize=function(ref){return this.c.finalize(ref)},Fp3d.prototype.maxTimeRemain=function(){return this.c.maxTimeRemain()},Fp3d.prototype.loadWinners=function(){var self=this;return self.c.currentRound().then(function(_round){return new _promise2["default"](function(r,j){async.times(_round.toNumber()-1,function(i,callback){self.c.rounds(i+1,callback)},function(err,rounds){return err?j(err):(rounds=rounds.map(function(r,i){var winner=r[3],amount=r[4].dividedBy(Math.pow(10,18)).toNumber();return{round:i+1,winner:winner,amount:amount}}),void r(rounds))})})})},exports.getFp3d=getFp3d;